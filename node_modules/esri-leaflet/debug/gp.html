<html>
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LeafletJS ArcGIS Test</title>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
<!-- Leaflet -->
<link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.css" />
<script src="https://npmcdn.com/leaflet@1.0.0-rc.2/dist/leaflet.js"></script>
<!-- Esri Leaflet -->
<script  src="https://cdn.jsdelivr.net/leaflet.esri/2.0.0/esri-leaflet.js"></script>
<!-- Esri Leaflet GP -->
<script src="https://cdn.jsdelivr.net/leaflet.esri.gp/2.0.0/esri-leaflet-gp.js"></script>
<!-- Esri Leaflet Renderers -->
<script src="https://cdn.jsdelivr.net/leaflet.esri.renderers/2.0.2/esri-leaflet-renderers.js"></script>


<style>

html {
	box-sizing: border-box;
	font-family: Verdana, sans-serif;
}
*, *:before, *:after {
	box-sizing: inherit;
}
body{
	margin: 0;
	padding: 0;
}

#wrapper {
	display: block;
	padding: 20px 0 0 20px;
}

.map_box {
	display: block;
	position: relative;
	width: 800px;
	height: 500px;
	margin-bottom: 20px;
}

.query_box {
	display: block;
	position: absolute;
	bottom: 10px;
	right: 10px;
	padding: 10px;
	background-color: rgba(51,51,51,0.7);
	color: #ffffff;
	z-index: 9000;
}
.query_box p {
	margin: 0;
}


</style>
</head>
<body>

	<div id="wrapper">

		<div class="map_box" id="map_wmp">
			<div class="query_box">
				<p><b>Output:</b></p>
				<button onClick="javascript:execQuery()" type="button" name="button">Query Debug</button>
			</div>
		</div>

	</div>

	<!-- Scripts -->
	<script type="text/javascript">


  /* Variables */
  L_PREFER_CANVAS = true;
  var wmpData = 'http://gis.orland-park.il.us/arcgis/rest/services/VotingPrecincts/MapServer/';
  var wmpTask = 'http://gis.orland-park.il.us/arcgis/rest/services/Buffer/GPServer/BufferPoint/';
  var wmpView = [41.601361, -87.852860];
  var wmpZoom = 12;

  /* ------------------------------------------------------------ Map */

  /* Initialize Map */
  var wmpMap = L.map(
  	'map_wmp',
  	{
  		attributionControl: false,
  		zoomControl: false
  	}
  ).setView(wmpView, wmpZoom);

  /* Map Tile Layers */
  var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(wmpMap);
  var esriMap = L.esri.basemapLayer('Imagery');

  var baseLayers = {
  	"Street Map": osm,
  	"Satellite Map": esriMap
  };


  /* Data Layers */
  var layer_00 = L.esri.featureLayer({
      url: wmpData + '0',
  });
  var layer_01 = L.esri.featureLayer({
      url: wmpData + '1'
  });
  var layer_02 = L.esri.featureLayer({
  	url: wmpData + '2'
  });
  var layer_03 = L.esri.featureLayer({
      url: wmpData + '3'
  }).addTo(wmpMap);
  var layer_04 = L.esri.featureLayer({
      url: wmpData + '4'
  });
  var layer_05 = L.esri.featureLayer({
      url: wmpData + '5'
  });
  var layer_06 = L.esri.featureLayer({
      url: wmpData + '6'
  });
  var layer_07 = L.esri.featureLayer({
      url: wmpData + '7'
  });


  var overlays = {
  	// "Layer 00": layer_00,
  	// "Layer 01": layer_01,
  	// "Layer 02": layer_02,
  	"Layer 03": layer_03,
  	// "Layer 04": layer_04,
  	// "Layer 05": layer_05,
  	// "Layer 06": layer_06,
  	// "Layer 07": layer_07
  };

  L.control.layers(
  	baseLayers,
  	overlays,
  	{
  		position: 'topleft',
  		collapsed: false
  	}
  ).addTo(wmpMap);



  /* Geometry */
  var sPoint = [41.597029, -87.888977];
  var sBuffer = 700;

  var selectionCircle = L.circle(
  	sPoint,
  	sBuffer,
  	{
  		color: '#BF3030',
  		weight: '2'
  	}
  ).addTo(wmpMap);



  /* ------------------------------------------------------------ Geoprocessing */
  var gpService = L.esri.GP.service({
  	async: true,
  	asyncInterval: 1,
    url: wmpTask
  });

  var gpTask = gpService.createTask();

  var gpPoint = L.latLng(sPoint);
  var gpBuffer = {
  	"distance" : 700,
  	"units" : "meters"
  };

  gpTask.setParam("Input_Features", gpPoint /* unsure what to use here */ );
  gpTask.setParam("Distance__value_or_field_", JSON.stringify(gpBuffer) /* Invalid Geometry? */);


  function testCallback(error, response, raw){
  	console.log(error);
  	console.log(response);
  	console.log(raw);
  }


  function execQuery(){
  	gpTask.run(testCallback);
  }

  </script>
</body>
</html>
