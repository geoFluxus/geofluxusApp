<!DOCTYPE html>
  <html>
  <head>
    <meta charset=utf-8 />
    <title>Esri Leaflet Debugging Sample</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Load Leaflet -->
    <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />
    <script src="../node_modules/leaflet/dist/leaflet-src.js"></script>

    <!-- Load Esri Leaflet from source-->
    <script src="../dist/esri-leaflet-debug.js"></script>

    <style>
      body {
        margin:0;
        padding:0;
      }

      #map {
        position: absolute;
        top:0;
        bottom:0;
        right:0;left:0;
      }

      #info-pane {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1000;
        padding: 1em;
        background: white;
      }
    </style>
  </head>
  <body>

  <div id="map"></div>
  <div id="info-pane" class="leaflet-bar">
    <label>
    sample application for debugging
    </label>
  </div>

  <script>
    // workaround for old ie
    if (!window.location.origin) {
      window.location.origin = window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port: '');
    }

    var map = L.map('map').setView([33.9743, -117.32754], 15);
    L.esri.basemapLayer('Topographic').addTo(map);

    function serverAuth(callback){
      L.esri.post('https://www.arcgis.com/sharing/rest/generateToken', {
        username: 'jgravois',
        password: '10speed',
        f: 'json',
        expiration: 60,
        client: 'referer',
        referer: window.location.origin
      }, callback);
    }

    serverAuth(function(error, response){
      var dl = L.esri.featureLayer({
        url: 'http://services.arcgis.com/uCXeTVveQzP4IIcx/arcgis/rest/services/Travel%20from%20Sustainability_Styrofoam_BatteryRecycling%20-%20Battery%20Recycling%20Containers%20(2%20Minutes)/FeatureServer/0',
        token: response.token
      }).addTo(map);

      dl.on('authenticationrequired', function (e) {
        serverAuth(function(error, response){
          e.authenticate(response.token);
        });
      });
    });
  </script>

  </body>
  </html>
