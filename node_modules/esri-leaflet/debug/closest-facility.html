<!DOCTYPE html>
  <html>
  <head>
    <meta charset=utf-8 />
    <title>Esri Leaflet Debugging Sample</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />

    <!-- Load Leaflet -->
    <link rel="stylesheet" href="../node_modules/leaflet/dist/leaflet.css" />
    <script src="../node_modules/leaflet/dist/leaflet-src.js"></script>

    <!-- Load Esri Leaflet from source-->
    <script src="../dist/esri-leaflet-debug.js"></script>

    <script src="https://unpkg.com/esri-leaflet-gp@2.0.1"></script>

    <style>
      body {
        margin:0;
        padding:0;
      }

      #map {
        position: absolute;
        top:0;
        bottom:0;
        right:0;left:0;
      }

      #info-pane {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 1000;
        padding: 1em;
        background: white;
      }
    </style>
  </head>
  <body>

  <div id="map"></div>
  <div id="info-pane" class="leaflet-bar">
    <label>
    sample application for debugging
    </label>
  </div>

  <script>
    var map = L.map('map').setView([33.77, -118.20], 12);
    L.esri.basemapLayer('Topographic').addTo(map);

    var closestFacilityService = L.esri.GP.service({
        url: "http://utility.arcgis.com/usrsvcs/appservices/uLllFwUwZbj9awbO/rest/services/World/ClosestFacility/NAServer/ClosestFacility_World",
        path: 'solveClosestFacility'
    });
    var closestFacilityTask = closestFacilityService.createTask();


    var hospitalQuery = L.esri.query({
      url: "http://public.gis.lacounty.gov/public/rest/services/LACounty_Dynamic/LMS_Data_Public/MapServer/81"
    })

    hospitalQuery.within(map.getBounds());

    hospitalQuery.run(function (err, response, raw) {
        var hospitals = response;
        closestFacilityTask.setParam("facilities", hospitals);

    })

    map.on("click", function (evt) {
        closestFacilityTask.setParam("incidents", evt.latlng);
        closestFacilityTask.run(function (err, res, raw) {
            console.log(res);
        })
    })
  </script>

  </body>
  </html>